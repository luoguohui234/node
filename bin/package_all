#!/bin/bash

###########################################################################
# Packaging script which creates all packages (Debian/Ubuntu/Linux/OSX/Windows)
#
# To package a build, simple execute:
#> bin/package_all <version>

# Usage example:
#> bin/package_all <version>

VERSION=$1
if [ -z "$VERSION" ]; then
    printf "\e[0;31m%s\e[0m\n" "Missing version!"
    exit 1
fi

DIR_BUILD="build/package"

printf "Creating build directory '$DIR_BUILD' ..\n" \
    && rm -rf ${DIR_BUILD} \
    && mkdir -p ${DIR_BUILD} \
    && cp INSTALL.md ${DIR_BUILD}/INSTALL.txt \
    && bin/server_build_xgo darwin/amd64 windows/amd64 linux/amd64 \
    && bin/client_build_xgo darwin/amd64 windows/amd64 linux/amd64 \
    && bin/builder_run BINARY=${DIR_BUILD}/mysterium_server_linux_amd64 bin/server_package_debian ${VERSION} amd64 \
    && bin/builder_run BINARY=${DIR_BUILD}/mysterium_client_linux_amd64 bin/client_package_debian ${VERSION} amd64 \
    && bin/server_package_docker ${VERSION} ${VERSION}-alpine alpine latest \
    && bin/server_package_docker_ubuntu ${VERSION} ${VERSION}-ubuntu ubuntu \
    && bin/client_package_docker ${VERSION} ${VERSION}-alpine alpine latest \
    && bin/client_package_docker_ubuntu ${VERSION} ${VERSION}-ubuntu ubuntu \
    && printf "\e[0;32m%s\e[0m\n" "All packages successfully packaged to directory '$DIR_BUILD'!"
